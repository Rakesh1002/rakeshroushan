---
---

<section id="newsletter" class="py-28 px-6">
  <div class="mx-auto max-w-5xl">
    <div class="max-w-lg">
      <p class="font-mono text-xs text-text-muted mb-4 tracking-wide">
        <span class="text-accent">#</span> newsletter
      </p>
      <p class="text-text-secondary mb-6 leading-relaxed">
        Weekly on AI product strategy, execution, and lessons from building 20+ products solo. No fluff.
      </p>

      <form class="flex gap-2" id="newsletter-form">
        <input
          type="email"
          name="email"
          required
          placeholder="you@company.com"
          class="flex-1 px-3 py-2 rounded bg-bg-secondary text-sm text-text placeholder:text-text-muted/50 focus:outline-none focus:ring-1 focus:ring-accent/50 transition-all font-mono"
        />
        <button
          type="submit"
          id="newsletter-btn"
          class="px-4 py-2 bg-accent hover:bg-accent-hover text-white text-sm font-mono rounded transition-colors disabled:opacity-40"
        >
          subscribe
        </button>
      </form>

      <p id="newsletter-msg" class="text-[11px] text-text-muted/50 mt-3 font-mono">
        Unsubscribe anytime.
      </p>
    </div>
  </div>
</section>

<script>
  const form = document.getElementById("newsletter-form") as HTMLFormElement;
  const btn = document.getElementById("newsletter-btn") as HTMLButtonElement;
  const msg = document.getElementById("newsletter-msg") as HTMLParagraphElement;

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = new FormData(form).get("email") as string;
    if (!email) return;

    btn.disabled = true;
    btn.textContent = "...";

    try {
      const res = await fetch("/api/newsletter", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email }),
      });
      const data = await res.json();
      if (res.ok) {
        msg.textContent = "You're in.";
        msg.classList.remove("text-text-muted/50");
        msg.classList.add("text-emerald-500");
        form.reset();
        btn.textContent = "done";
      } else {
        msg.textContent = data.error || "Failed. Try again.";
        msg.classList.add("text-red-400");
        btn.disabled = false;
        btn.textContent = "subscribe";
      }
    } catch {
      msg.textContent = "Network error.";
      msg.classList.add("text-red-400");
      btn.disabled = false;
      btn.textContent = "subscribe";
    }
  });
</script>
