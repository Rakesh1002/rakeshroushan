---
import { getCollection } from "astro:content";

const posts = (await getCollection("posts"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 4);
---

<section id="blog" class="py-28 px-6">
  <div class="mx-auto max-w-5xl">
    <div class="flex items-baseline justify-between mb-10">
      <div>
        <p class="font-mono text-xs text-text-muted mb-4 tracking-wide">
          <span class="text-accent">#</span> blog
        </p>
        <p class="text-text-muted text-sm">
          Frameworks, teardowns, and lessons from building 20+ AI products.
        </p>
      </div>
      {
        posts.length > 0 && (
          <a
            href="/blog"
            class="hidden sm:inline-block font-mono text-xs text-text-muted hover:text-accent transition-colors"
          >
            all posts &rarr;
          </a>
        )
      }
    </div>

    {
      posts.length > 0 ? (
        <div class="space-y-1">
          {posts.map((post) => (
            <a
              href={`/blog/${post.id}`}
              class="group block py-4 border-b border-border/50 last:border-0"
            >
              <div class="flex items-baseline justify-between gap-4 mb-1.5">
                <h3 class="text-sm font-medium group-hover:text-accent transition-colors">
                  {post.data.title}
                </h3>
                <time class="text-xs text-text-muted/40 font-mono shrink-0">
                  {post.data.date.toLocaleDateString("en-US", {
                    year: "numeric",
                    month: "short",
                    day: "numeric",
                  })}
                </time>
              </div>
              <p class="text-xs text-text-muted leading-relaxed line-clamp-1">
                {post.data.description}
              </p>
            </a>
          ))}
        </div>
      ) : (
        <p class="text-text-muted/50 text-sm font-mono py-16 text-center">
          No posts yet. Check back soon.
        </p>
      )
    }
  </div>
</section>
