---
import Base from "@/layouts/Base.astro";
import Nav from "@/components/sections/Nav.astro";
import Footer from "@/components/sections/Footer.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<Base
  title={`${post.data.title} - Rakesh Roushan`}
  description={post.data.description}
>
  <Nav />
  <main class="pt-28 pb-24 px-6">
    <article class="mx-auto max-w-3xl">
      <a
        href="/blog"
        class="inline-flex items-center gap-2 text-sm text-text-muted hover:text-text mb-8 transition-colors"
      >
        <svg
          class="w-4 h-4"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"></path>
        </svg>
        Back to blog
      </a>

      <header class="mb-12">
        <time class="text-sm text-text-muted">
          {
            post.data.date.toLocaleDateString("en-US", {
              year: "numeric",
              month: "long",
              day: "numeric",
            })
          }
        </time>
        <h1 class="text-4xl font-bold mt-3 mb-4">{post.data.title}</h1>
        <p class="text-lg text-text-secondary">{post.data.description}</p>

        {
          post.data.tags && (
            <div class="flex flex-wrap gap-2 mt-6">
              {post.data.tags.map((tag: string) => (
                <span class="text-xs px-2.5 py-1 rounded-md bg-bg-secondary text-text-muted border border-border">
                  {tag}
                </span>
              ))}
            </div>
          )
        }
      </header>

      <div
        class="prose prose-invert prose-zinc max-w-none
          prose-headings:font-semibold
          prose-a:text-accent prose-a:no-underline hover:prose-a:underline
          prose-code:text-accent prose-code:bg-bg-secondary prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded
          prose-pre:bg-bg-secondary prose-pre:border prose-pre:border-border prose-pre:rounded-xl"
      >
        <Content />
      </div>
    </article>
  </main>
  <Footer />
</Base>
